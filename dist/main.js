(()=>{"use strict";const e=[0,10,20,30,40,50,60,70,80,90],t=[9,19,29,39,49,59,69,79,89,99];class i{constructor(e,t=null){this.position=e,this.hit=!1,this.ship=t,this.adjacentSquare=!1,this.edge=this.isEdge(this),this.revealed=!1}isEdge(i){return e.includes(i.position)?"left":!!t.includes(i.position)&&"right"}enableClick(){l.enableClick(document.getElementById(`e-${this.position}`))}disableClick(e){e||l.disableClick(document.getElementById(`e-${this.position}`))}}class s{constructor(e=!1){this.squares=this.initializeBoard(),this.player=e,this.ships=[]}initializeBoard(){let e=[];for(let t=0;t<100;t++){const s=new i(t);e.push(s)}return e}placeShip(e){e.position.forEach((t=>{t.ship=e,this.setAdjacentSquares(t,e)}))}setAdjacentSquares(e,t){const i=[e.position-10,e.position+10];"right"!==e.edge&&(i.push(e.position+1),i.push(e.position+11),i.push(e.position-9)),"left"!==e.edge&&(i.push(e.position-1),i.push(e.position-11),i.push(e.position+9)),i.forEach((e=>{if(e<0||e>99)return;let i=this.getSquare(e);i.adjacentSquare=!0,t.adjacentSquares.push(i)}))}getHVSquares(e){const t=[this.getSquare(e.position-10),this.getSquare(e.position+10)];return"right"!==e.edge&&t.push(this.getSquare(e.position+1)),"left"!==e.edge&&t.push(this.getSquare(e.position-1)),t}revealAdjacentSquares(e){e.adjacentSquares.forEach((e=>{e.ship||(e.revealed=!0,l.displaySquare(e,this.player),e.disableClick(this.player))}))}recieveAttack(e){e.disableClick(this.player),e.hit=!0,e.ship&&(e.ship.hit(),this.player&&("random"===o.nextEnemyMove?o.nextEnemyMove=["hitAdjacent",e]:"hitAdjacent"===o.nextEnemyMove[0]&&(o.nextEnemyMove=["sinkShip",e.ship]))),l.displaySquare(e,this.player),e.ship&&e.ship.isSunk()&&(this.revealAdjacentSquares(e.ship),l.sinkShip(e.ship,this.player),this.ships=this.ships.filter((t=>t!==e.ship)),this.player&&(o.nextEnemyMove="random"),0!==this.ships.length||o.hasEnded||r.endGame(this.player))}getCell(e){return this.player?document.getElementById(`p-${e.position}`):document.getElementById(`e-${e.position}`)}getSquare(e){return this.squares[e]}parseSquares(e,t){const i=t.length,s=t.rotation;if("v"===s){if(e.position+10*(i-1)>99)return!1}else if("h"===s&&e.position%10+i>10)return!1;return!0}checkConflict(e){let t=!1;return e.position.forEach((e=>{(e.ship||e.adjacentSquare)&&(t=!0)})),t}getAvailablePositions(){let e=[];return this.squares.forEach((t=>{t.ship||t.adjacentSquare||e.push(t.position)})),e}getUnseenSquares(){let e=[];return this.squares.forEach((t=>{t.hit||t.revealed||e.push(t)})),e}}class n{constructor(e){this.length=e,this.position=[],this.set=!1,this.hits=0,this.sunk=!1,this.rotation="v",this.adjacentSquares=[]}hit(){return this.hits++,this.isSunk(),this.hits}isSunk(){return this.hits===this.length&&(this.sunk=!0),this.sunk}setPos(e,t){if("v"===this.rotation)for(let i=0;i<this.length;i++)this.position.push(t.board.getSquare(e.position+10*i));else if("h"===this.rotation)for(let i=0;i<this.length;i++)this.position.push(t.board.getSquare(e.position+i))}lockPos(){this.set=!0}rotate(){this.rotation="v"===this.rotation?"h":"v"}}class a{constructor(e=!1){this.player=e,this.ships=[],this.board=new s(e)}initialize(){if(!this.player){let e;this.enableAllSquares();let t=[new n(5),new n(4),new n(3),new n(3),new n(2),null],i=t.shift();for(;t.length>0;){i.position=[];let s=this.board.getAvailablePositions();i.rotation=Math.floor(2*Math.random())?"h":"v",e=s[Math.floor(Math.random()*s.length)];let n=this.board.getSquare(e);this.board.parseSquares(n,i)&&(i.setPos(n,this),this.board.checkConflict(i)||(i.set=!0,this.board.placeShip(i),this.board.ships.push(i),i=t.shift()))}}}enableSquares(){this.board.squares.forEach((e=>{e.revealed||e.enableClick()}))}enableAllSquares(){this.board.squares.forEach((e=>{e.enableClick()}))}disableAllSquares(){this.board.squares.forEach((e=>{e.disableClick()}))}}const o={hasEnded:!1,player:new a(!0),enemy:new a,turn:"player",nextEnemyMove:"random",start:()=>{l.displayAllShips(o.player),r.initialize(),o.enemy.initialize()},end:()=>{o.enemy.disableAllSquares(),o.hasEnded=!0},enemyMove(){"random"===o.nextEnemyMove?o.enemyRandomMove():"hitAdjacent"===o.nextEnemyMove[0]?o.enemyHitAdjacent(o.nextEnemyMove[1]):"sinkShip"===o.nextEnemyMove[0]&&o.enemySinkShip(o.nextEnemyMove[1])},enemyRandomMove(){let e=o.player.board.getUnseenSquares(),t=e[Math.floor(Math.random()*e.length)];o.player.board.recieveAttack(t)},enemyHitAdjacent(e){let t=o.player.board.getHVSquares(e);const i=o.player.board.getUnseenSquares();t=t.filter((e=>i.includes(e)));let s=t[Math.floor(Math.random()*t.length)];o.player.board.recieveAttack(s)},enemySinkShip(e){let t=[],i=[],s=[];e.position.forEach((e=>{e.hit&&(s.push(e),i.push(e.position))}));const n=i.indexOf(Math.min(...i)),a=i.indexOf(Math.max(...i));"v"===e.rotation?(t.push(o.player.board.getSquare(s[n].position-10)),t.push(o.player.board.getSquare(s[a].position+10))):"h"===e.rotation&&(t.push(o.player.board.getSquare(s[n].position-1)),t.push(o.player.board.getSquare(s[a].position+1)));let l=o.player.board.getUnseenSquares();t=t.filter((e=>l.includes(e)));let r=t[Math.floor(Math.random()*t.length)];o.player.board.recieveAttack(r)}},l={displayShip(e,t=!1,i=!1){t?e.position.forEach((e=>{document.getElementById(`b-${e.position}`).classList.add("green")})):i?e.position.forEach((e=>{document.getElementById(`e-${e.position}`).classList.add("green")})):e.position.forEach((e=>{document.getElementById(`p-${e.position}`).classList.add("green")}))},displayAllShips(e,t=!1,i=!1){e.board.ships.forEach((e=>{l.displayShip(e,t,i)}))},displaySquare(e,t){e.ship?this.displayRed(e,t):this.displayBlue(e,t)},displayModalRed(e,t=1,i="v"){let s=10*Math.ceil(e.position/10);if(document.getElementById(`b-${e.position}`).classList.add("red"),"h"===i)for(let i=1;i<t;i++)e.position+i<s&&document.getElementById(`b-${e.position+i}`).classList.add("red");else if("v"===i)for(let i=10;i<10*t;i+=10)e.position+i<=99&&document.getElementById(`b-${e.position+i}`).classList.add("red")},displayRed(e,t){t?document.getElementById(`p-${e.position}`).classList.add("red"):document.getElementById(`e-${e.position}`).classList.add("red")},displayGrey(e,t=!1){let i;i=t?document.getElementById(`p-${e.position}`):document.getElementById(`e-${e.position}`),i.classList.add("grey")},displayBlue(e,t=!1){let i;i=t?document.getElementById(`p-${e.position}`):document.getElementById(`e-${e.position}`),i.classList.add("blue")},displayBlueGrey(e,t=!1){let i;i=t?document.getElementById(`p-${e.position}`):document.getElementById(`e-${e.position}`),i.classList.add("bluegrey")},displayDarkGrey(e,t=!1){let i;i=t?document.getElementById(`p-${e.position}`):document.getElementById(`e-${e.position}`),i.classList.add("greyblack")},clearBoard(e=!1){if(e)for(let e=0;e<100;e++){const t=document.getElementById(`b-${e}`);t.classList.remove("green"),t.classList.remove("red")}},disableClick(e){e.classList.add("disable-click")},enableClick(e){e.classList.remove("disable-click")},sinkShip(e,t){e.position.forEach((e=>{l.displayBlueGrey(e,t)}))},clearModal(){document.getElementById("modal-content").innerHTML=""},populateEndScreen(e){const t=document.getElementById("modal-content");t.style.width="15%",t.style.marginTop="15%",t.style.borderRadius="10px","player"===e?t.innerHTML="<p>Congratulations! You won!</p>":"enemy"===e&&(t.innerHTML="<p>Oh no! Better luck next time...</p>");const i=document.createElement("button");i.textContent="Play Again",i.addEventListener("click",(()=>{location.reload()})),i.style.width="120px",i.style.margin="auto",t.appendChild(i)},showModal(){document.querySelector(".modal").style.display="block"},addX(e){e.innerHTML="X"},removeX(e){let t=e.id.substring(2);o.enemy.board.getSquare(t).hit||(e.innerHTML="")}},r={initialize:()=>{document.querySelectorAll(".enemy-cell").forEach((e=>{e.addEventListener("click",(()=>{if(!e.classList.contains("disable-click")){let t=e.id.substring(2),i=o.enemy.board.getSquare(t);o.enemy.board.recieveAttack(i),o.enemyMove()}}))}))},endGame:e=>{const t=e?"enemy":"player";o.end(),l.clearModal(),l.populateEndScreen(t),l.showModal()}};!function(){let e=[new n(5),new n(4),new n(3),new n(3),new n(2)],t=e.shift();document.getElementById("rotate").addEventListener("click",(()=>{t.rotate()})),document.querySelectorAll(".modal-cell").forEach((i=>{i.addEventListener("mouseenter",(()=>{let e=i.id.substring(2),s=o.player.board.getSquare(e);o.player.board.parseSquares(s,t)?(t.setPos(s,o.player),o.player.board.checkConflict(t)?(l.displayModalRed(s,t.length,t.rotation),l.disableClick(i)):l.displayShip(t,!0)):(l.displayModalRed(s,t.length,t.rotation),l.disableClick(i))})),i.addEventListener("mouseleave",(()=>{t.set||(t.position=[],l.clearBoard(!0),o.player.board.ships.forEach((e=>{e.set&&l.displayShip(e,!0)}))),l.enableClick(i)})),i.addEventListener("click",(()=>{i.classList.contains("disable-click")||(t.set=!0,o.player.board.placeShip(t),o.player.board.ships.push(t),0===e.length?(modal=document.querySelector(".modal"),modal.style.display="none",o.start()):t=e.shift())}))}))}()})();